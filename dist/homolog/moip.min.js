!function(a,b){b["true"]=a,/*! moip.js - version: 1.0.0 - 11/04/2014 */
function(){var a="1.0.0",b="http://homolog/order-api/v2",c={version:a,targetUrl:b};c.create=function(a){var b=new c.FormEncryptor(a),d=new c.PaymentSender(this.targetUrl);return{onSubmit:b.onSubmit,postPayment:d.postPayment}},c.FormEncryptor=function(a){this.publicKey=a.publicKey;var b=[],d=new JSEncrypt({default_key_size:2048});d.setPublicKey(this.publicKey);var e=new c.FormExtractor,f=new c.JsonBuilder,g=new c.PaymentSender(c.targetUrl),h=function(a){for(var c=0;c<b.length;c++)a.removeChild(b[c]),b.shift()},i=function(a){return d.encrypt(a)},j=function(a,b){var c=document.createElement(a);for(var d in b)if(b.hasOwnProperty(d)){var e=b[d];c.setAttribute(d,e)}return c},k=function(a){for(var c=0;c<a.length;c++){var d=a[c],e=d.getAttribute("data-encrypted-input"),f=i(d.value);d.removeAttribute("name");var g=j("input",{value:f,type:"hidden",name:e});b.push(g)}return b},l=function(a,b){for(var c=0;c<b.length;c++)a.appendChild(b[c])},m=function(a){var b=e.extractInputs(a);h(a);var c=k(b);l(a,c)},n=function(a,b){window.jQuery?window.jQuery(a).submit(b):a.addEventListener?a.addEventListener("submit",b,!1):a.attachEvent&&a.attachEvent("onsubmit",b)};this.onSubmit=function(a,b,c){b=e.findForm(b);var d=function(){m(b);var d=f.build(b);g.postPayment(a,d,c)};n(b,d)}},window.Moip=c,c.FormExtractor=function(){this.findForm=function(a){return window.jQuery&&a instanceof jQuery?a[0]:a.nodeType&&1===a.nodeType?a:document.getElementById(a)},this.extractInputs=function(a){for(var b=[],c=a.children,d=0;d<c.length;d++){var e=c[d];1===e.nodeType&&(e.attributes["data-encrypted-input"]||e.attributes["data-input"])?b.push(e):e.children&&e.children.length>0&&b.concat(this.extractInputs(e))}return b}},c.JsonBuilder=function(){var a=new c.FormExtractor,b=function(a){var b=/\[([a-zA-Z0-9]+)\]/,c=a.split(b),d=[];if(c)for(var e=0;e<c.length;e++)c[e]&&d.push(c[e]);return d},d=function(a,b,c){for(var d=b.length-1,e=0;d>e;++e){var f=b[e];f in a||(a[f]={}),a=a[f]}a[b[d]]=c},e=function(a){for(var c={},e=0;e<a.length;e++){var f=a[e];f.hasAttribute("data-input")?d(c,b(f.getAttribute("data-input")),f.value):"hidden"===f.getAttribute("type")&&d(c,b(f.getAttribute("data-encrypted-input")),f.value)}return c};this.build=function(b){var c=a.findForm(b),d=a.extractInputs(c);return e(d)}},c.PaymentSender=function(a){var b=this;b.baseUrl=a;var c={callbackCounter:0,fetch:function(a,b){var c="JSONPCallback_"+this.callbackCounter++;window[c]=this.evalJSONP(b),a=a.replace("=JSONPCallback","="+c);var d=document.createElement("script");d.src=a;var e=document.createElement("div");return e.setAttribute("id",c),e.appendChild(d),document.getElementsByTagName("body")[0].appendChild(e),e},evalJSONP:function(a){return function(b){var c=!1;if("string"==typeof b)try{c=JSON.parse(b)}catch(d){}else c=JSON.parse(JSON.stringify(b)),window.console&&console.warn("response data was not a JSON string");if(!c)throw"JSONP call returned invalid or empty JSON";a(c)}}},d=function(a){return/ORD-[a-zA-Z0-9]{12}/.test(a)},e=function(a){return/MOR-[a-zA-Z0-9]{12}/.test(a)},f=function(a,c){if(d(a))return b.baseUrl+"/orders/"+a+"/payments/jsonp?payment="+encodeURIComponent(JSON.stringify(c))+"&callback=JSONPCallback";if(e(a))return b.baseUrl+"/multiorders/"+a+"/multipayments/jsonp?payment="+encodeURIComponent(JSON.stringify(c))+"&callback=JSONPCallback";throw"Unknown id ["+a+"],  doesn't belong to any order or multiorder."},g=function(a,b,d){var e=c.fetch(a,d);document.getElementsByTagName("body")[0].removeChild(e)};this.postPayment=function(a,b,c){var d=f(a,b);g(d,b,c)}}}()}({},function(){return this}());
